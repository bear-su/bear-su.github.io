# ëª¨ë“ˆí™”ë¥¼ ìœ„í•œ ê¸´ ì—¬ì •
ì´ë²ˆ Tour Korea í† ì´ í”„ë¡œì íŠ¸ë¥¼ ì§„í–‰í•˜ë©°, ëª¨ë“ˆí™”ì™€ MSAë¥¼ ì ìš©í•˜ëŠ” ì†Œì¤‘í•œ ê²½í—˜ì„ í–ˆìŠµë‹ˆë‹¤. 
ë§ì€ ê¸°ìˆ  ë¸”ë¡œê·¸ì™€ ì±…ì„ ì°¸ê³ í•˜ë©° ëª¨ë“ˆí™”ì˜ ì²«ê±¸ìŒì„ ë–¼ì—ˆê³ , ê·¸ ê³¼ì •ì—ì„œì˜ ì‹œí–‰ì°©ì˜¤ë¥¼ ê³µìœ í•©ë‹ˆë‹¤.

## ì–´ë–»ê²Œ ëª¨ë“ˆí™” í•  ê²ƒì¸ê°€?
ëª¨ë“ˆí™”ì˜ ë°©ë²•ì€ í”„ë¡œì íŠ¸ì˜ íŠ¹ì„±ê³¼ ëª¨ë“ˆì˜ í¬ê¸°ì— ë”°ë¼ ë‹¤ì–‘í•©ë‹ˆë‹¤. ì œê°€ ì°¸ê³ í•œ ê¸°ìˆ  ë¸”ë¡œê·¸ì™€ ì„œì ë§ˆë‹¤ ì œì‹œí•˜ëŠ” ë°©ë²•ì´ ë‹¬ëìŠµë‹ˆë‹¤.

ì €ì˜ ëª¨ë“ˆí™”ì˜ ëª©ì ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.
1. í•œ ë²ˆ ëª¨ë“ˆì„ ë§Œë“¤ë©´ ë‹¤ë¥¸ í”„ë¡œì íŠ¸ì—ì„œë„ ì¬í™œìš©í•˜ê³  ì‹¶ë‹¤. 
   - ë„ë©”ì¸ ë‹¨ìœ„, ê¸°ëŠ¥ ë‹¨ìœ„ë¡œ ì¬í™œìš©í•˜ê³  ì‹¶ë‹¤.
2. ì½”ë“œë¥¼ ë³€ê²½í–ˆì„ ë•Œ ì „íŒŒë˜ëŠ” ì˜í–¥ë„ë¥¼ ìµœì†Œí™”í•˜ê³  ì‹¶ë‹¤.

ì´ë¥¼ ìœ„í•´ì„œ ë‹¤ìŒ ê¸°ì¤€ìœ¼ë¡œ ëª¨ë“ˆí™”ë¥¼ ì§„í–‰í–ˆìŠµë‹ˆë‹¤.
> **í•˜ë‚˜ì˜ ì±…ì„**, **ë…ë¦½ì **, **ì¬í™œìš©** ì¸¡ë©´ì—ì„œ ëª¨ë“ˆì„ ë¶„ë¦¬í–ˆë‹¤.

## ì²« ë²ˆì§¸ ì‹œë„
![first_module.png](..%2F..%2Fassets%2Fimg%2Fproject%2Fmsa%2Ffirst_module.png)

- ë„ë©”ì¸ì„ Aggregate ì¦‰, ë°ì´í„° ë³€ê²½ì˜ ë‹¨ìœ„ë¡œ ë¬¶ì–´ì„œ ì„œë¹„ìŠ¤ë¥¼ ë‚˜ëˆ„ì—ˆë‹¤.
- ì—¬ê¸°ì„œ ë„ë©”ì¸ì€ `í”„ë¡œê·¸ë˜ë°ìœ¼ë¡œ í•´ê²°í•˜ê³ ì í•˜ëŠ” ì£¼ì œ`ë¥¼ ì˜ë¯¸í•œë‹¤.
- ê³µí†µì ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” `Security`, `Exception ì²˜ë¦¬`, `API ì‘ë‹µ í´ë˜ìŠ¤`, `Config í´ë˜ìŠ¤` ë“±ì„ ìœ„ì¹˜ì‹œì¼°ë‹¤.
![first_folder.png](..%2F..%2Fassets%2Fimg%2Fproject%2Fmsa%2Ffirst_folder.png)

### ë¬¸ì œì 
1. ë‹¤ë¥¸ ëª¨ë“ˆì—ì„œ ê³µí†µì ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” ì˜ì¡´ì„±ì„ Core-Serviceì— ì¶”ê°€í•˜ë‹¤ ë³´ë‹ˆ ë¶ˆí•„ìš”í•œ ì˜ì¡´ì„±ì„ ê°–ê²Œ ëœë‹¤.
   - Core-Serviceì˜ `OpenFeign` ì˜ì¡´ì„±ì€ `File-Service`ì—ì„œëŠ” ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ì˜ì¡´ì„±
   - í”„ë¡œì íŠ¸ ê°„ì˜ ì˜ì¡´ì„± í™•ì¸ì´ ì–´ë ¤ì›Œì§„ë‹¤.

    `Core-Service`ì˜ build.gradle íŒŒì¼
    ~~~Gradle
    dependencies {
        implementation 'org.springframework.boot:spring-boot-starter-web'
        implementation 'org.springframework.boot:spring-boot-starter-security'
    
        // JWT
        runtimeOnly("io.jsonwebtoken:jjwt-jackson:0.11.5")
        runtimeOnly("io.jsonwebtoken:jjwt-impl:0.11.5")
        implementation("io.jsonwebtoken:jjwt-api:0.11.5")
    
        // OpenFeign
        implementation 'org.springframework.cloud:spring-cloud-starter-openfeign'
    
        implementation 'org.springframework.cloud:spring-cloud-starter-netflix-eureka-client:4.1.0'
    
        implementation 'org.springdoc:springdoc-openapi-starter-webmvc-ui:2.4.0'
    
        compileOnly 'org.projectlombok:lombok'
        annotationProcessor 'org.projectlombok:lombok'
        testImplementation 'org.springframework.boot:spring-boot-starter-test'
    }
    ~~~
    
    `File-Service`ì˜ build.gradle íŒŒì¼
    ~~~Gradle
    dependencies {
        implementation project(':core-service')
        implementation 'org.springdoc:springdoc-openapi-starter-webmvc-ui:2.4.0'
    
        testImplementation 'org.springframework.boot:spring-boot-starter-test'
    
        implementation 'com.amazonaws:aws-java-sdk-s3:1.12.683'
    }
    ~~~

2. ê³„ì¸µ ë³„ë¡œ ì™„ë²½í•œ ìº¡ìŠí™”ë¥¼ ë‹¬ì„±í•˜ê¸° ì–´ë µë‹¤.
   - ì‹¤ì œë¡œ ë¦¬íŒ©í† ë§ í•˜ëŠ” ê³¼ì •ì—ì„œ ê³„ì¸µì˜ ê´€ê³„ê°€ ëª¨í˜¸í•´ì§€ê³  ìˆìŒì„ í™•ì¸í•¨.
   - Service ê³„ì¸µì—ì„œ ì™¸ë¶€ ì‹œìŠ¤í…œì„ í˜¸ì¶œí•˜ëŠ” ì½”ë“œê°€ ì¡´ì¬.

    ```Java
    public void sendPasswordResetEmail(String email) {
        // ì´ë©”ì¼ í† í°ì„ ìƒì„±í•˜ê³  ì €ì¥í•˜ëŠ” ë¡œì§
        var link = UUID.randomUUID().toString();
        emailTokenRepository.save(
                EmailToken.builder()
                        .email(email)
                        .link(link)
                        .build()
        );
    
        // ì´ë©”ì¼ í…œí”Œë¦¿ì„ ë§Œë“¤ê³  ì´ë¥¼ ì „ì†¡í•˜ëŠ” ë¡œì§ 
        var message = javaMailSender.createMimeMessage();
        MimeMessageHelper helper = null;
        try {
            helper = new MimeMessageHelper(message, true);
            helper.setTo(email);
            var context = new Context();
            context.setVariable("link", link);
            var html = templateEngine.process("PasswordEmailForm.html", context);
            helper.setText(html, true);
            javaMailSender.send(message);
        } catch (MessagingException e) {
            throw new RuntimeException(e);
        }
    }
    ```
ë‹¤ìŒ ì½”ë“œì˜ ë¬¸ì œëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.
1. ì´ë©”ì¼ í† í°ì„ ìƒì„±í•˜ê³  ì €ì¥í•˜ëŠ” ë¡œì§ê³¼ ì´ë©”ì¼ì„ ì „ì†¡í•˜ëŠ” ë¡œì§ì´ ê°™ì€ ë ˆì´ì–´, í•¨ìˆ˜ì— ì¡´ì¬í•œë‹¤. 
2. ì½”ë“œë¥¼ ì½ì„ ë•Œ ì„¸ë¶€ë¡œì§ì„ í•˜ìœ„ ë ˆì´ì–´ì— ìœ„ì„í•´ì•¼ ì½”ë“œê°€ ì½ê¸° ì‰¬ì›Œì§€ëŠ”ë° ì´ë¥¼ ë‹¬ì„±í•˜ì§€ ëª»í–ˆë‹¤.

## ë‘ ë²ˆì§¸ ì‹œë„
 - ë‘ ë²ˆì§¸ ì‹œë„ì—ì„œë„ ë„ë©”ì¸ì„ Aggregate ì¦‰, ë°ì´í„° ë³€ê²½ì˜ ë‹¨ìœ„ë¡œ ë¬¶ì–´ì„œ ì„œë¹„ìŠ¤ë¥¼ ë‚˜ëˆ„ì—ˆë‹¤.
 - í•˜ì§€ë§Œ, `Core-Service`ë¥¼ ì‘ì€ ë‹¨ìœ„ì¸ `Global Utils`, `Component`ë¡œ ì„¸ë¶€ ëª¨ë“ˆí™” í•˜ì˜€ë‹¤.
 - ê°ê°ì˜ ë„ë©”ì¸ë„ `api`, `bridge`, `domain`ìœ¼ë¡œ ì„¸ë¶€ ëª¨ë“ˆí™”í•˜ì˜€ë‹¤.

![second_module.png](..%2F..%2Fassets%2Fimg%2Fproject%2Fmsa%2Fsecond_module.png)


### ğŸ” [ ï¸Global Utils ]
- **"ê°€ëŠ¥í•œ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤"** ë¥¼ ê¸°ë³¸ ì›ì¹™ìœ¼ë¡œ í•œë‹¤.
- Pure Javaë¡œ êµ¬ì„±ëœë‹¤.
- ëª¨ë“  í”„ë¡œê·¸ë¨ì— ì „ì—­ì ìœ¼ë¡œ ì‚¬ìš©ë  ìˆ˜ ìˆëŠ” ì½”ë“œê°€ ì—¬ê¸°ì— ë“¤ì–´ê°„ë‹¤.
- `Utils í´ë˜ìŠ¤`, `ì‘ë‹µ ì½”ë“œ`

### ğŸ” [ Component ]
- Pure Javaë¡œ ì‚¬ìš©í•  ìˆ˜ëŠ” ì—†ì§€ë§Œ, ë§ì€ ëª¨ë“ˆì—ì„œ ê³µí†µì ìœ¼ë¡œ ì‚¬ìš©ë  ìˆ˜ ìˆëŠ” ëª¨ë“ˆ
- `Jwt ëª¨ë“ˆ`, `Security ëª¨ë“ˆ`, `ì˜ˆì™¸ ì²˜ë¦¬ ëª¨ë“ˆ`


### ğŸ” [ Application ]
- ê° ì„œë¹„ìŠ¤ì— í•„ìš”í•œ ëª¨ë“ˆì„ ëª¨ë‘ ì„í¬íŠ¸í•˜ê¸°ì— SpringBoot Mainì‹¤í–‰ íŒŒì¼ë§Œ ìœ„ì¹˜ì‹œí‚¨ë‹¤.
- í•„ìš”í•œ ë¹ˆ ë“¤ì„ ë“±ë¡í•˜ê³  ê´€ë¦¬í•  ìˆ˜ ìˆë„ë¡ Config ì„¤ì •ì„ í•œë‹¤.
- `UserService`, `PostService`, `FileService` ë“±
- ì„œë¹„ìŠ¤ ì•ˆì—ì„œì˜ ì˜ì¡´ì„± ê²©ë¦¬ì™€ ìœ ì§€ë³´ìˆ˜ì„± ì¦ê°€ë¥¼ ìœ„í•´ Application ëª¨ë“ˆë„ ë‹¤ì‹œ ëª¨ë“ˆí™”í•˜ì˜€ë‹¤.
  #### API ë ˆì´ì–´
  - Controller: ì‚¬ìš©ìì˜ ìš”ì²­ì„ ë°›ê³  ì‘ë‹µì„ ë°˜í™˜í•˜ëŠ” ì—­í• ì„ í•œë‹¤.
  
  #### Bridge ë ˆì´ì–´ 
  - APIì™€ Service ì‚¬ì´ì—ì„œ ë°ì´í„°ë¥¼ ê°€ê³µí•˜ê±°ë‚˜ ë³€í™˜í•˜ëŠ” ì—­í• ì„ í•œë‹¤.
  
  #### Domain ë ˆì´ì–´
  - Entity, Repository, Serviceë¥¼ ì •ì˜í•œë‹¤.

### ğŸ‘ ì¥ì  
1. ëª¨ë“ˆ ì„¸ë¶„í™”ë¥¼ í†µí•´ í•„ìš”í•œ ì˜ì¡´ì„±ë§Œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìœ¼ë©° ì´ë¥¼ í†µí•´ ì˜ì¡´ê´€ê³„ íŒŒì•…ë„ ìš©ì´í•´ì§„ë‹¤.
   - `file-service`ì˜ gradle íŒŒì¼
     ~~~gradle
     dependencies {
         implementation project(':global-utils')
         implementation project(':component-exception')
         implementation project(':component-security')
         implementation 'org.springdoc:springdoc-openapi-starter-webmvc-ui:2.4.0'
         testImplementation 'org.springframework.boot:spring-boot-starter-test'
         implementation 'com.amazonaws:aws-java-sdk-s3:1.12.683'
      }
     ~~~

2. ì„¸ë¶€ ë¡œì§ì„ í•˜ìœ„ ë ˆì´ì–´ì— ìœ„ì„í•˜ê²Œ ê°•ì œí•¨ìœ¼ë¡œì¨ ë” ì½ê¸° í¸í•œ ì½”ë“œê°€ ëœë‹¤.
  - ì´ì „ì—ëŠ” emailTokenServiceì˜ ë¡œì§ê³¼ mailSenderServiceì˜ ë¡œì§ì´ í•œ í•¨ìˆ˜ì— ì¡´ì¬í–ˆì§€ë§Œ, ì´ë¥¼ ìœ„ì„í•¨ìœ¼ë¡œì¨ ë” ì½ê¸° ì‰¬ìš´ ì½”ë“œê°€ ë˜ì—ˆë‹¤
~~~Java
public void sendPasswordResetEmail(PasswordResetRequestForm form) {
    var link = UUID.randomUUID().toString();
    EmailToken emailToken = emailTokenService.save(
            EmailToken.of(link)
    );
    
    mailSenderService.sendPasswordResetEmail(emailToken.getEmail(), emailToken.getLink());
}
~~~

3. ë ˆì´ì–´ ê°„ì˜ ë””ì»¤í”Œë§ì´ ì‹¬í•´ ì½”ë“œì˜ ì–‘ì´ ë§ì•„ì§€ì§€ë§Œ ì „íŒŒë˜ëŠ” ì˜í–¥ë„ë¥¼ ìµœì†Œí™”í•  ìˆ˜ ìˆë‹¤. 
   - ê° ë ˆì´ì–´ëŠ” í•˜ìœ„ ë ˆì´ì–´ì—ë§Œ ì˜ì¡´ì„±ì„ ê°€ì§€ê¸° ë•Œë¬¸ì— domainê³„ì¸µì—ì„œ bridge ê³„ì¸µì— ì •ì˜ëœ RegisterRequestë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤. 
   - bridgeì—ì„œ ì¸ì½”ë”©í•œ íŒ¨ìŠ¤ì›Œë“œë¥¼ DTOí´ë˜ìŠ¤ì— ë‹´ì•„ ë„˜ê²¨ì£¼ê¸° ë•Œë¬¸ì— domain ë ˆì´ì–´ì—ì„œ ì‚¬ìš©ì íšŒì›ê°€ì…ì— ë” ì§‘ì¤‘í•  ìˆ˜ ìˆë‹¤.
    ~~~Java
    public UserDetail registerUser(RegisterRequest form) {
        UserDTO.RegisterDTO registerDTO = form.toDTO(encodePassword(form.password()));
    
        User user = userService.registerUser(registerDTO);
    
        return UserDetail.toResponse(user);
    }
    ~~~
   

